<!DOCTYPE html>
<html lang="uk">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Порадник з вибору спеціальності – Драгі</title>
    <style>
      /*
        Основні кольори та змінні. Вибрані для передачі атмосфери застосунку DRAGI.
        Змінні полегшують редизайн: достатньо змінити колір тут, щоб оновились усі елементи.
      */
      :root {
        --grad-start: #ff8a00; /* теплий помаранчевий */
        --grad-mid: #ff3e90;  /* рожевий відтінок */
        --grad-end: #7a00ff;  /* фіолетовий, який домінує у DRAGI */
        --card-bg: #ffffff;   /* фон картки */
        --card-shadow: rgba(0, 0, 0, 0.1);
        --text-primary: #2a0d5d; /* темно‑фіолетовий для заголовків */
        --text-secondary: #4b2c82; /* фіолетовий для допоміжного тексту */
        --button-bg: #ff8a00; /* для основної кнопки */
        --button-bg-secondary: #7a00ff; /* для вторинних кнопок */
        --button-text: #ffffff;
        --progress-bg: rgba(255, 255, 255, 0.3);
        --progress-fill: #ffffff;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
          Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
      }
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      body,
      html {
        height: 100%;
        width: 100%;
      }
      body {
        /* створюємо градієнтний фон схожий на DRAGI */
        background: linear-gradient(45deg, var(--grad-start), var(--grad-mid), var(--grad-end));
        background-size: 400% 400%;
        animation: gradientShift 15s ease infinite;
        color: var(--text-primary);
        display: flex;
        justify-content: center;
        align-items: center;
        overflow-x: hidden;
      }

      /* Коли показується екран результату, ми хочемо притиснути вміст до верху.
         Додаємо цей клас до body під час показу результату. */
      body.result-mode {
        align-items: flex-start;
      }
      @keyframes gradientShift {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
      }
      #app {
        width: 100%;
        max-width: 480px;
        margin: 0 auto;
        position: relative;
      }
      /* Екрани приховуються за замовчуванням. Активація робить відповідний
         екран видимим. Для стартового екрана застосовуємо флекс‑центрування,
         а для інших екранних використовуємо базовий блоковий режим. */
      #start-screen,
      #question-screen,
      #result-screen {
        display: none;
        width: 100%;
        min-height: 100vh;
        padding: 20px;
        overflow-y: auto;
      }

      /* Для результату вимикаємо власний скрол, щоб користувач одразу бачив заголовок */
      #result-screen {
        overflow-y: visible;
      }
      #start-screen.active {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
        color: #ffffff;
      }
      #question-screen.active {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }
      #result-screen.active {
        /* Режим відображення результату. Використовуємо блочне розміщення без флекса.
           Встановлюємо лише базові параметри. Реальний відступ з верхнього краю
           задається на внутрішньому контейнері #result-content. */
        display: block;
        text-align: center;
        max-width: 480px;
        margin: 0 auto;
      }
      #start-screen h1 {
        font-size: 2rem;
        font-weight: 700;
        margin-bottom: 1rem;
      }
      #start-screen p {
        font-size: 1rem;
        line-height: 1.4;
        margin-bottom: 1.5rem;
      }
      #start-screen .start-btn {
        background: var(--button-bg);
        color: var(--button-text);
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: 12px;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.25);
        transition: transform 0.2s;
      }
      #start-screen .start-btn:hover {
        transform: scale(1.05);
      }
      /* Картка запитання */
      .card-wrapper {
        position: relative;
        width: 100%;
        height: 400px;
        max-height: 60vh;
      }
      .card {
        position: absolute;
        width: 100%;
        height: 100%;
        background: var(--card-bg);
        border-radius: 20px;
        box-shadow: 0 8px 20px var(--card-shadow);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
        padding: 1.5rem;
        transition: transform 0.3s ease, opacity 0.3s ease;
        user-select: none;
        /* Забороняємо браузеру обробляти жести самостійно, щоб краще реагувати на горизонтальні свайпи на мобільних */
        touch-action: none;
      }
      .card h2 {
        font-size: 1.4rem;
        margin-bottom: 1rem;
        color: var(--text-primary);
      }
      .card .emoji {
        font-size: 3rem;
        margin-bottom: 0.5rem;
      }
      .progress-container {
        width: 100%;
        height: 6px;
        background: var(--progress-bg);
        border-radius: 3px;
        margin-top: 2rem;
        overflow: hidden;
      }
      .progress-bar {
        height: 100%;
        width: 0;
        background: var(--progress-fill);
        transition: width 0.3s ease;
      }
      .instruction {
        margin-top: 1rem;
        font-size: 0.9rem;
        color: #ffffff;
        text-align: center;
      }
      /* Результат */
      #result-screen {
        color: #ffffff;
      }
      #result-screen h2 {
        font-size: 1.6rem;
        font-weight: 700;
        margin-bottom: 1rem;
        color: #ffffff;
      }
      #result-screen p {
        font-size: 1rem;
        margin-bottom: 0.8rem;
        line-height: 1.4;
      }
      #result-screen p strong {
        font-weight: 700;
      }
      .cta {
        margin-top: 1.5rem;
        background: rgba(255, 255, 255, 0.15);
        padding: 1rem;
        border-radius: 12px;
        backdrop-filter: blur(10px);
      }
      .cta h3 {
        font-size: 1.2rem;
        margin-bottom: 0.5rem;
        color: #ffffff;
      }
      .cta p {
        font-size: 0.9rem;
        color: #f5e8ff;
        margin-bottom: 0.6rem;
      }
      .store-buttons {
        display: flex;
        gap: 0.5rem;
        margin-top: 0.5rem;
      }
      .store-buttons a {
        flex: 1;
        text-decoration: none;
        background: var(--button-bg);
        color: var(--button-text);
        padding: 0.6rem 0.8rem;
        border-radius: 8px;
        font-weight: 600;
        font-size: 0.9rem;
        text-align: center;
        display: inline-block;
        transition: opacity 0.2s ease;
      }
      .store-buttons a.play {
        background: var(--button-bg-secondary);
      }
      .store-buttons a:hover {
        opacity: 0.85;
      }
      .next-tool {
        margin-top: 1rem;
        text-align: center;
        color: #ffffff;
      }
      .next-tool a {
        display: inline-block;
        margin-top: 0.5rem;
        background: var(--button-bg-secondary);
        color: var(--button-text);
        padding: 0.6rem 1rem;
        border-radius: 8px;
        font-weight: 600;
        text-decoration: none;
      }

      /* Внутрішній блок результату, який містить заголовок та пояснення. Саме
         тут ми додаємо верхній відступ, щоб зміст відображався трішки нижче
         середини екрана. */
      #result-content {
        /* Використовуємо padding, а не margin, щоб відступ не колапсував з батьківським
           елементом і блок завжди відштовхувався від верхнього краю.
           Щоб заголовок результуючого блоку знаходився ближче до середини екрана,
           збільшуємо відступ до приблизно 35 % висоти вікна. Це дає помітний відступ
           на мобільних, щоб користувач одразу бачив рекомендацію, але не зливався
           з верхнім краєм. */
        padding-top: 50vh;
        padding-left: 20px;
        padding-right: 20px;
      }

      /* Виділяємо ключові фрази у CTA */
      .cta p strong {
        font-weight: 700;
      }

      /* Кнопка повторного проходження */
      .retry-btn {
        background: var(--button-bg-secondary);
        color: var(--button-text);
        padding: 0.75rem 1.2rem;
        border: none;
        border-radius: 12px;
        font-size: 1.0rem;
        font-weight: 600;
        cursor: pointer;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.25);
        transition: transform 0.2s;
      }
      .retry-btn:hover {
        transform: scale(1.05);
      }
    </style>
  </head>
  <body>
    <div id="app">
      <!-- Стартовий екран -->
      <div id="start-screen" class="screen active">
        <!-- Логотип Драгі (використовуємо пряме посилання) -->
        <img src="https://i.postimg.cc/vmg13FdM/with-book.png" alt="Dragi" style="width: 140px; height:auto; margin-bottom: 1rem;" />
        <h1>Інтерактивний вибір спеціальності від Драгі</h1>
        <p>
          Цей короткий тест допоможе визначити загальний напрямок спеціальності,
          що підходить саме тобі. Ми врахуємо твої інтереси та перспективність
          професій на ринку.
        </p>
        <p>
          <strong>Як це працює:</strong> перед тобою з’являтимуться картки
          запитань. Свайпай <strong>вправо</strong>, якщо погоджуєшся,
          <strong>вліво</strong> — якщо ні. Можна просто клікнути на правий
          або лівий бік картки.
        </p>
        <button class="start-btn" onclick="startQuiz()">Почати</button>
      </div>
      <!-- Екран запитань -->
      <div id="question-screen" class="screen">
        <div class="card-wrapper" id="card-wrapper"></div>
        <div class="progress-container">
          <div class="progress-bar" id="progress-bar"></div>
        </div>
        <div class="instruction">Свайпай вправо для «Так» або вліво для «Ні», або натисни відповідний бік картки</div>
      </div>
      <!-- Екран результату -->
      <div id="result-screen" class="screen">
        <!-- Внутрішній контейнер для результатів. Відступ зверху налаштовується через CSS (#result-content). -->
        <div id="result-content">
          <h2 id="result-title"></h2>
          <p id="result-why"></p>
          <p id="result-prospects"></p>
        </div>
        <div class="cta">
          <h3>Де почати👇</h3>
          <p>
            Найприємніше навчатись на бюджеті🤓<br>
            Тому радимо вже подумати про підготовку до НМТ.<br>
            Маємо для тебе класний варіант — це підготовка в застосунку Драгі.<br>
            <strong>Драгі — це про «все в одному місці», зручність, ефективність та цікавість.</strong><br>
            Тобі точно сподобається!🔥<br>
            <strong>Завантажуй застосунок</strong> та спробуй першу тему <strong>безкоштовно!</strong>
          </p>
          <!-- Фото скрінів застосунку (використовуємо пряме посилання) -->
          <img src="https://i.postimg.cc/L84LkbX6/scnjhs.jpg" alt="Скрін з застосунку Драгі" style="width: 100%; border-radius: 12px; margin-top: 0.5rem;" />
          <div class="store-buttons">
            <a href="https://apps.apple.com/ua/app/%D0%B4%D1%80%D0%B0%D0%B3%D1%96-%D0%BF%D1%96%D0%B4%D0%B3%D0%BE%D1%82%D0%BE%D0%B2%D0%BA%D0%B0-%D0%B4%D0%BE-%D0%BD%D0%BC%D1%82-%D0%B7%D0%BD%D0%BE/id6502047535" target="_blank" rel="noopener" class="store">App Store</a>
            <a href="https://play.google.com/store/apps/details?id=ua.dragi.education" target="_blank" rel="noopener" class="store play">Google Play</a>
          </div>
        </div>
        <div class="next-tool">
          <p>Хочеш дізнатись, який вибірковий предмет варто складати для цієї чи іншої спеціальності?</p>
          <a href="http://fourth-subject.dragi.blog" target="_blank" rel="noopener">Скористайся інструментом↗️</a>
          <!-- Кнопка повтору -->
          <div style="margin-top: 1rem;">
            <button class="retry-btn" onclick="resetQuiz()">Спробувати знову🔄</button>
          </div>
        </div>
      </div>
    </div>
    <script>
      // ==== Дані для мета-спеціальностей ====
      const metaSpecialties = [
        {
          id: 'prePrimary',
          name: 'Дошкільна та початкова освіта',
          baseTags: [1, 1, 1, 1],
          tags: {
            CODE: 0,
            HARDWARE: 0,
            CREATIVE: 0,
            LAB: 0,
            BUSINESS: 0,
            OUTDOOR: 0,
            HEALTH: 0,
            DATA: 0,
            LEGAL: 0,
            SAFETY: 0,
          },
          growth: '-1%',
          growthSource: '【767193882339983†L278-L283】',
          why: 'Ти любиш працювати з дітьми, маєш гуманітарні інтереси та цінуєш стабільність.',
        },
        {
          id: 'teacherHumanities',
          name: 'Вчитель гуманітарних дисциплін',
          baseTags: [1, 1, 1, 1],
          tags: {
            CODE: 0,
            HARDWARE: 0,
            CREATIVE: 1,
            LAB: 0,
            BUSINESS: 0,
            OUTDOOR: 0,
            HEALTH: 0,
            DATA: 0,
            LEGAL: 0,
            SAFETY: 0,
          },
          growth: '-1%',
          growthSource: '【767193882339983†L278-L283】',
          why: 'Ти тяжієш до гуманітарних предметів та відчуваєш покликання передавати знання іншим.',
        },
        {
          id: 'teacherSTEM',
          name: 'Вчитель STEM',
          baseTags: [1, 1, 0, 1],
          tags: {
            CODE: 0,
            HARDWARE: 0,
            CREATIVE: 0,
            LAB: 1,
            BUSINESS: 0,
            OUTDOOR: 0,
            HEALTH: 0,
            DATA: 1,
            LEGAL: 0,
            SAFETY: 0,
          },
          growth: '10.4%',
          growthSource: '【833591425690171†L71-L76】',
          why: 'Ти обожнюєш точні науки та хочеш надихати молодь розвиватися у STEM.',
        },
        {
          id: 'physicalArt',
          name: 'Фізична культура та мистецтво в школі',
          baseTags: [1, 1, 1, 1],
          tags: {
            CODE: 0,
            HARDWARE: 0,
            CREATIVE: 1,
            LAB: 0,
            BUSINESS: 0,
            OUTDOOR: 1,
            HEALTH: 0,
            DATA: 0,
            LEGAL: 0,
            SAFETY: 0,
          },
          growth: '-1%',
          growthSource: '【767193882339983†L278-L283】',
          why: 'Ти творчий та активний, любиш спорт або мистецтво й хочеш працювати з дітьми.',
        },
        {
          id: 'humanitiesScience',
          name: 'Гуманітарні науки',
          baseTags: [1, 0, 1, 1],
          tags: {
            CODE: 0,
            HARDWARE: 0,
            CREATIVE: 1,
            LAB: 1,
            BUSINESS: 0,
            OUTDOOR: 0,
            HEALTH: 0,
            DATA: 0,
            LEGAL: 0,
            SAFETY: 0,
          },
          growth: '-1%',
          growthSource: '【767193882339983†L278-L283】',
          why: 'Ти любиш гуманітарні дослідження, але не боїшся працювати з науковими методами.',
        },
        {
          id: 'socialScienceJournalism',
          name: 'Соціальні науки та журналістика',
          baseTags: [1, 0, 1, 0],
          tags: {
            CODE: 0,
            HARDWARE: 0,
            CREATIVE: 0,
            LAB: 0,
            BUSINESS: 0,
            OUTDOOR: 0,
            HEALTH: 0,
            DATA: 1,
            LEGAL: 0,
            SAFETY: 0,
          },
          growth: '7%',
          growthSource: '【141952358008472†L275-L279】',
          why: 'Ти любиш аналізувати суспільні явища та розповідати історії через медіа.',
        },
        {
          id: 'businessEconomy',
          name: 'Бізнес та економіка',
          baseTags: [0, 0, 0, 0],
          tags: {
            CODE: 0,
            HARDWARE: 0,
            CREATIVE: 0,
            LAB: 0,
            BUSINESS: 1,
            OUTDOOR: 0,
            HEALTH: 0,
            DATA: 1,
            LEGAL: 0,
            SAFETY: 0,
          },
          growth: 'Над середнім',
          growthSource: '【482143824612595†L226-L229】',
          why: 'Ти орієнтуєшся на фінанси та управління, цікавишся економікою та підприємництвом.',
        },
        {
          id: 'lawIntl',
          name: 'Право та міжнародні відносини',
          baseTags: [1, 0, 1, 1],
          tags: {
            CODE: 0,
            HARDWARE: 0,
            CREATIVE: 0,
            LAB: 0,
            BUSINESS: 0,
            OUTDOOR: 0,
            HEALTH: 0,
            DATA: 0,
            LEGAL: 1,
            SAFETY: 0,
          },
          growth: '5%',
          growthSource: '【289679856404314†L272-L276】',
          why: 'Ти небайдужий до справедливості, прав людини та дипломатії.',
        },
        {
          id: 'psychologySocial',
          name: 'Психологія та соціальна робота',
          baseTags: [1, 1, 1, 1],
          tags: {
            CODE: 0,
            HARDWARE: 0,
            CREATIVE: 0,
            LAB: 0,
            BUSINESS: 0,
            OUTDOOR: 0,
            HEALTH: 1,
            DATA: 0,
            LEGAL: 0,
            SAFETY: 0,
          },
          growth: '7%',
          growthSource: '【141952358008472†L275-L279】',
          why: 'Ти прагнеш допомагати людям, підтримувати їхній ментальний добробут.',
        },
        {
          id: 'naturalSciences',
          name: 'Природничі науки',
          baseTags: [0, 0, 0, 1],
          tags: {
            CODE: 0,
            HARDWARE: 0,
            CREATIVE: 0,
            LAB: 1,
            BUSINESS: 0,
            OUTDOOR: 1,
            HEALTH: 0,
            DATA: 1,
            LEGAL: 0,
            SAFETY: 0,
          },
          growth: '10.4%',
          growthSource: '【833591425690171†L71-L76】',
          why: 'Тебе захоплює наука, лабораторні дослідження та вивчення природи.',
        },
        {
          id: 'ictCyber',
          name: 'ІКТ та кібербезпека',
          baseTags: [0, 0, 0, 0],
          tags: {
            CODE: 1,
            HARDWARE: 0,
            CREATIVE: 0,
            LAB: 0,
            BUSINESS: 0,
            OUTDOOR: 0,
            HEALTH: 0,
            DATA: 1,
            LEGAL: 0,
            SAFETY: 0,
          },
          growth: '17%',
          growthSource: '【872032855443557†L281-L284】',
          why: 'Ти любиш програмувати, працювати з даними та захищати інформацію.',
        },
        {
          id: 'engineeringTech',
          name: 'Інженерія та технології',
          baseTags: [0, 0, 0, 0],
          tags: {
            CODE: 0,
            HARDWARE: 1,
            CREATIVE: 0,
            LAB: 0,
            BUSINESS: 0,
            OUTDOOR: 0,
            HEALTH: 0,
            DATA: 0,
            LEGAL: 0,
            SAFETY: 0,
          },
          growth: '11%',
          growthSource: '【476138005167650†L276-L279】',
          why: 'Ти прагнеш створювати, будувати й вирішувати технічні задачі.',
        },
        {
          id: 'constructionArchitecture',
          name: 'Будівництво та архітектура',
          baseTags: [0, 0, 0, 1],
          tags: {
            CODE: 0,
            HARDWARE: 1,
            CREATIVE: 1,
            LAB: 0,
            BUSINESS: 0,
            OUTDOOR: 1,
            HEALTH: 0,
            DATA: 0,
            LEGAL: 0,
            SAFETY: 0,
          },
          growth: '11%',
          growthSource: '【476138005167650†L276-L279】',
          why: 'Тобі подобається проектувати простір та працювати з матеріалами на свіжому повітрі.',
        },
        {
          id: 'agroBio',
          name: 'Агро- та біоресурси',
          baseTags: [1, 0, 0, 1],
          tags: {
            CODE: 0,
            HARDWARE: 0,
            CREATIVE: 0,
            LAB: 1,
            BUSINESS: 0,
            OUTDOOR: 1,
            HEALTH: 0,
            DATA: 0,
            LEGAL: 0,
            SAFETY: 0,
          },
          growth: 'Над середнім',
          growthSource: '【833591425690171†L71-L76】',
          why: 'Ти цікавишся природою, сільським господарством і любиш працювати на відкритому повітрі.',
        },
        {
          id: 'medicineHealth',
          name: 'Медицина та здоров’я',
          baseTags: [1, 1, 0, 1],
          tags: {
            CODE: 0,
            HARDWARE: 0,
            CREATIVE: 0,
            LAB: 1,
            BUSINESS: 0,
            OUTDOOR: 0,
            HEALTH: 1,
            DATA: 0,
            LEGAL: 0,
            SAFETY: 0,
          },
          growth: '16%',
          growthSource: '【517189456593073†L283-L286】',
          why: 'Ти любиш працювати з людьми та цікавишся здоров’ям, відчуваєш покликання допомагати іншим.',
        },
        {
          id: 'transportSafety',
          name: 'Транспорт та безпека',
          baseTags: [0, 0, 0, 1],
          tags: {
            CODE: 0,
            HARDWARE: 0,
            CREATIVE: 0,
            LAB: 0,
            BUSINESS: 0,
            OUTDOOR: 0,
            HEALTH: 0,
            DATA: 0,
            LEGAL: 0,
            SAFETY: 1,
          },
          growth: '5%',
          growthSource: '【289679856404314†L272-L276】',
          why: 'Ти хочеш підтримувати порядок, безпеку та працювати в сфері транспорту.',
        },
      ];

      // Базові питання (4 штуки). Кожне питання відповідає бітам baseTags.
      const baseQuestions = [
        {
          text: 'Мені комфортніше взаємодіяти з людьми, ніж із механізмами/даними?',
          emoji: '🤝',
        },
        {
          text: 'Я хочу допомагати й забезпечувати добробут інших, а не створювати продукти чи керувати бізнесом?',
          emoji: '🤲',
        },
        {
          text: 'Тягне до гуманітарних/творчих завдань, а не до розрахунків та логіки?',
          emoji: '🎭',
        },
        {
          text: 'Віддаю перевагу стабільним і зрозумілим траєкторіям, а не ризиковим стартапам?',
          emoji: '🛡️',
        },
      ];

      // Бібліотека другорядних тегів для динамічного п’ятого питання
      const tieBreakQuestions = {
        CODE: { text: 'Любиш програмувати або працювати з кодом?', emoji: '💻' },
        HARDWARE: { text: 'Цікаво возитися з механізмами / обладнанням?', emoji: '🔧' },
        CREATIVE: { text: 'Тягне до творчості (малюнок, сцена, музика)?', emoji: '🎨' },
        LAB: { text: 'Надихає лабораторна / наукова робота?', emoji: '🔬' },
        BUSINESS: { text: 'Мрієш керувати бізнесом або стартапом?', emoji: '💼' },
        OUTDOOR: { text: 'Охоче працював(-ла) б поза офісом / на свіжому повітрі?', emoji: '🌿' },
        HEALTH: { text: 'Цікавить медицина й здоров’я людей?', emoji: '❤️‍🩹' },
        DATA: { text: 'Любиш аналізувати цифри та статистику?', emoji: '📊' },
        LEGAL: { text: 'Захоплюють закони та справедливість?', emoji: '⚖️' },
        SAFETY: { text: 'Готовий(-ва) працювати в сфері безпеки / надзвичайних ситуацій?', emoji: '🚒' },
      };

      // Поточний стан квізу
      let currentStep = 0;
      let pool = [...metaSpecialties];
      let lastPool = [...metaSpecialties];
      let dynamicQuestions = [];
      let answers = [];

      const cardWrapper = document.getElementById('card-wrapper');
      const progressBar = document.getElementById('progress-bar');

      function startQuiz() {
        // перехід від старту до питання
        document.getElementById('start-screen').classList.remove('active');
        document.getElementById('result-screen').classList.remove('active');
        document.getElementById('question-screen').classList.add('active');
        // Повертаємо стандартне вертикальне вирівнювання для body
        document.body.classList.remove('result-mode');
        // прокручуємо до початку сторінки, щоб уникнути залишків стартового екрану
        window.scrollTo(0, 0);
        currentStep = 0;
        pool = [...metaSpecialties];
        lastPool = [...metaSpecialties];
        dynamicQuestions = [];
        answers = [];
        renderNextCard();
      }

      function renderNextCard() {
        cardWrapper.innerHTML = '';
        let question;
        // вирішуємо, яке питання показати
        if (currentStep < baseQuestions.length) {
          question = baseQuestions[currentStep];
        } else {
          // Якщо потрібен тай-брейк
          // Вибираємо найкращий другорядний тег
          const tag = pickTieBreakTag(pool);
          if (!tag) {
            // якщо не знайдено тега, або залишилося 1-2
            showResult();
            return;
          }
          dynamicQuestions.push(tag);
          question = tieBreakQuestions[tag];
        }
        // Створюємо картку
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `<div class="emoji">${question.emoji}</div><h2>${question.text}</h2>`;
        // Позиція по центру
        card.style.transform = 'translate(0, 0) rotate(0deg)';
        cardWrapper.appendChild(card);
        // Додаємо обробники свайпу/кліку
        attachInteraction(card);
        // Оновлюємо прогресбар
        // Прогресбар показує частку базових запитань (4 штуки). Додаткові
        // тай‑брейк питання не збільшують смужку, щоб уникнути стрибків.
        const totalBase = baseQuestions.length;
        const progress = Math.min(currentStep / totalBase, 1) * 100;
        progressBar.style.width = `${progress}%`;
      }

      function attachInteraction(card) {
        let startX = null;
        let currentX = null;
        let isDragging = false;
        // Змінні для роботи з сенсорними подіями (touch) на мобільних
        let touchStartX = null;
        let isTouching = false;
        // початок жесту
        card.addEventListener('pointerdown', (e) => {
          startX = e.clientX;
          isDragging = true;
          card.setPointerCapture(e.pointerId);
        });
        // перетягування
        card.addEventListener('pointermove', (e) => {
          if (!isDragging) return;
          currentX = e.clientX;
          const deltaX = currentX - startX;
          card.style.transform = `translate(${deltaX}px, 0) rotate(${deltaX / 10}deg)`;
        });
        // завершення свайпу
        card.addEventListener('pointerup', (e) => {
          if (!isDragging) return;
          isDragging = false;
          const deltaX = e.clientX - startX;
          // визначаємо поріг свайпу
          const threshold = card.offsetWidth * 0.25;
          if (deltaX > threshold) {
            registerAnswer(true, card);
          } else if (deltaX < -threshold) {
            registerAnswer(false, card);
          } else {
            // повертаємо в центр
            card.style.transition = 'transform 0.3s ease';
            card.style.transform = 'translate(0, 0) rotate(0deg)';
            setTimeout(() => {
              card.style.transition = '';
            }, 300);
          }
          card.releasePointerCapture(e.pointerId);
        });
        /*
          Додаткові обробники для мобільних пристроїв. Деякі браузери не
          підтримують pointerevents повною мірою, тому відслідковуємо touch
          жести. Ми дублюємо логіку pointer‑свайпу, але використовуємо
          touchclientX. Під час переміщення забираємо вертикальний скрол
          (preventDefault), щоб уникнути конфлікту з прокручуванням.
        */
        card.addEventListener('touchstart', (e) => {
          const touch = e.touches[0];
          touchStartX = touch.clientX;
          isTouching = true;
        });
        card.addEventListener('touchmove', (e) => {
          if (!isTouching) return;
          const touch = e.touches[0];
          const deltaX = touch.clientX - touchStartX;
          card.style.transform = `translate(${deltaX}px, 0) rotate(${deltaX / 10}deg)`;
          // запобігаємо вертикальному скролу під час свайпу
          e.preventDefault();
        }, { passive: false });
        card.addEventListener('touchend', (e) => {
          if (!isTouching) return;
          isTouching = false;
          const touch = e.changedTouches[0];
          const deltaX = touch.clientX - touchStartX;
          const threshold = card.offsetWidth * 0.25;
          if (deltaX > threshold) {
            registerAnswer(true, card);
          } else if (deltaX < -threshold) {
            registerAnswer(false, card);
          } else {
            card.style.transition = 'transform 0.3s ease';
            card.style.transform = 'translate(0, 0) rotate(0deg)';
            setTimeout(() => {
              card.style.transition = '';
            }, 300);
          }
        });
        // клік на лівий або правий бік
        card.addEventListener('click', (e) => {
          // Якщо відбувся значний свайп, то клік ігноруємо
          if (isDragging) return;
          const rect = card.getBoundingClientRect();
          const x = e.clientX - rect.left;
          const isYes = x > rect.width / 2;
          registerAnswer(isYes, card);
        });
      }

      function registerAnswer(isYes, card) {
        // анімація відлітання
        card.style.transition = 'transform 0.3s ease, opacity 0.3s ease';
        const direction = isYes ? 1 : -1;
        card.style.transform = `translate(${direction * 400}px, 0) rotate(${direction * 30}deg)`;
        card.style.opacity = '0';
        // затримка, щоб завершити анімацію
        setTimeout(() => {
          processAnswer(isYes);
        }, 300);
      }

      function processAnswer(answer) {
        answers.push(answer);
        // Визначаємо, чи це базове запитання чи «тай‑брейк».
        if (currentStep < baseQuestions.length) {
          // Ми відповідаємо на базове запитання. Фільтруємо пул за відповідним
          // бітам baseTags. answer=true → 1, false → 0.
          pool = pool.filter((sp) => sp.baseTags[currentStep] === (answer ? 1 : 0));
          if (pool.length === 0) {
            // fallback: якщо після фільтрації пул спорожнів, беремо попередній
            // набір спеціальностей, але з протилежною відповіддю на це запитання.
            pool = lastPool.filter((sp) => sp.baseTags[currentStep] !== (answer ? 1 : 0));
          }
          lastPool = [...pool];
          currentStep++;
          // Якщо ми ще не закінчили всі базові запитання, показуємо наступну картку.
          if (currentStep < baseQuestions.length) {
            renderNextCard();
            return;
          }
          // Якщо це була відповідь на останнє базове запитання, перевіряємо,
          // чи залишився лише один або два варіанти. Якщо так – показуємо
          // результат, інакше переходимо до тай‑брейк запитань.
          if (pool.length <= 1) {
            showResult();
            return;
          }
          // Після завершення базових питань та якщо варіантів більше одного
          // показуємо першу тай‑брейк картку (renderNextCard обере її).
          renderNextCard();
          return;
        } else {
          // Ми відповідаємо на тай‑брейк запитання.
          const tagKey = dynamicQuestions[dynamicQuestions.length - 1];
          pool = pool.filter((sp) => sp.tags[tagKey] === (answer ? 1 : 0));
          if (pool.length === 0) {
            // fallback: повертаємо попередній пул, але з протилежною відповіддю
            pool = lastPool.filter((sp) => sp.tags[tagKey] !== (answer ? 1 : 0));
          }
          lastPool = [...pool];
          currentStep++;
          // Після кожного тай‑брейк запитання перевіряємо, чи залишилась
          // одна спеціальність. Якщо так – завершуємо. Якщо варіантів більше,
          // але вже перебрали декілька тай‑брейків і кількість варіантів
          // невелика (наприклад 2), можемо завершити й показати всі. Щоб
          // уникнути нескінченного циклу, якщо питання не розділяють, ми
          // обмежуємося двома тай‑брейк запитаннями. Якщо після двох
          // запитань залишається більше двох варіантів, вибираємо першу. 
          if (pool.length <= 1 || dynamicQuestions.length >= 2) {
            showResult();
            return;
          }
          renderNextCard();
          return;
        }
      }

      // Вибір тега для тай‑брейк питання
      function pickTieBreakTag(currentPool) {
        if (currentPool.length <= 1) return null;
        // підраховуємо кількість спеціальностей з 1 та 0 для кожного тегу
        const tags = Object.keys(tieBreakQuestions);
        let bestTag = null;
        let bestGain = -1;
        tags.forEach((tag) => {
          let yes = 0;
          let no = 0;
          currentPool.forEach((sp) => {
            if (sp.tags[tag] === 1) yes++;
            else no++;
          });
          // інф. вигода: чим ближче yes ≈ no, тим краще
          const gain = 1 - Math.abs(yes - no) / currentPool.length;
          if (gain > bestGain && (yes > 0 && no > 0)) {
            bestGain = gain;
            bestTag = tag;
          }
        });
        return bestTag;
      }

      function showResult() {
        document.getElementById('question-screen').classList.remove('active');
        document.getElementById('result-screen').classList.add('active');
        // Додаємо клас до body, щоб притиснути вміст до верху. Це прибирає
        // вертикальне центрирування і дозволяє використати padding-top на
        // #result-content для відступу.
        document.body.classList.add('result-mode');
        // беремо перший варіант з пулу
        const result = pool[0] || lastPool[0];
        // Заповнюємо текст
        document.getElementById('result-title').textContent = `Розглянь такий напрямок як — «${result.name}»`;
        document.getElementById('result-why').innerHTML = `<strong>Чому:</strong> ${result.why}`;
        // Виводимо перспективи без посилань; джерела надано в описі застосунку
        document.getElementById('result-prospects').innerHTML = `<strong>Перспектива:</strong> очікуване зростання попиту ${result.growth} до 2030–2033&nbsp;р.`;
        // прогресбар заповнюємо повністю
        progressBar.style.width = '100%';

        // Прокручуємо сторінку на початок, щоб користувач одразу бачив результат.
        // Далі він зможе самостійно прокрутити вниз до CTA. Без цього
        // деякі браузери залишалися на попередній позиції й заголовок
        // рекомендації потрапляв за межі видимості.
        // Використовуємо setTimeout, щоб прокрутка відбулася після оновлення DOM.
        setTimeout(() => {
          window.scrollTo(0, 0);
        }, 50);
      }

      // Повертає користувача на стартовий екран для повторного проходження
      function resetQuiz() {
        // Скидаємо класи активності
        document.getElementById('result-screen').classList.remove('active');
        document.getElementById('question-screen').classList.remove('active');
        document.getElementById('start-screen').classList.add('active');
        // Повертаємо стандартне вертикальне вирівнювання для body
        document.body.classList.remove('result-mode');
        // Прокручуємо вгору
        window.scrollTo(0, 0);
      }
    </script>
  </body>
</html>